name: Deploy

on:
  push:
    branches: [ main, devin/1752750425-arctic-ice-solutions-initial-commit ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
          
      - name: Build frontend for production
        env:
          VITE_API_URL: https://api.yourchoiceice.com
          VITE_GOOGLE_MAPS_API_KEY: ${{ secrets.GOOGLE_MAPS_API_KEY || '' }}
        run: |
          cd frontend
          pnpm install
          pnpm build
          
      - name: Deploy to Devin Platform
        env:
          DEVIN_TOKEN: ${{ secrets.DEVIN_TOKEN }}
        run: |
          cd frontend
          npx @devin/cli deploy --token=$DEVIN_TOKEN --domain=yourchoiceice.com --build-dir=dist
