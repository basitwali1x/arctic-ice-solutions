name: Deploy

on:
  push:
    branches: [ main, devin/1752750425-arctic-ice-solutions-initial-commit ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
          
      - name: Build frontend for production
        env:
          VITE_API_URL: https://api.yourchoiceice.com
          VITE_GOOGLE_MAPS_API_KEY: ${{ secrets.GOOGLE_MAPS_API_KEY || '' }}
        run: |
          cd frontend
          pnpm install
          pnpm build
          
      - name: Fix API URL configuration in build
        env:
          VITE_API_URL: https://api.yourchoiceice.com
        run: |
          node force-env-update.js
          
      - name: Deploy to Devin Platform
        run: |
          echo "Deploying frontend build artifacts to Devin Apps Platform"
          echo "App ID: ice-management-app-4r16aafs"
          echo "Build directory: frontend/dist"
          echo "Environment: production"
          echo "Domain: yourchoiceice.com"
          ls -la frontend/dist/
          echo "Note: Actual deployment to Devin Apps Platform requires manual deploy_frontend command"
          echo "GitHub Actions cannot directly deploy to Devin Apps Platform"
          echo "Build artifacts are ready for deployment"
